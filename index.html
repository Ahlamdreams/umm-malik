<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ - Ù…ØªØ²Ø§Ù…Ù†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        /* [Ø§Ù„Ø£Ù†Ù…Ø§Ø· (CSS) Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙƒÙ…Ø§ ÙƒØ§Ù†Øª ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ] */
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; overflow-x: hidden; position: relative; min-height: 100vh; direction: rtl; }
        .live-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: linear-gradient(45deg, #ff6b9d, #ffa726, #ab47bc, #42a5f5); background-size: 400% 400%; animation: modernGradientFlow 15s ease infinite; }
        .background-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 20% 50%, rgba(255, 107, 157, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(171, 71, 188, 0.3) 0%, transparent 50%), radial-gradient(circle at 40% 80%, rgba(66, 165, 245, 0.3) 0%, transparent 50%); animation: modernBackgroundPulse 8s ease-in-out infinite; }
        .floating-particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .glowing-orb { position: absolute; border-radius: 50%; background: radial-gradient(circle, rgba(255, 255, 255, 0.8), rgba(255, 107, 157, 0.4)); box-shadow: 0 0 20px rgba(255, 107, 157, 0.6); animation: floatOrb 20s linear infinite; }
        .sparkle { position: absolute; width: 4px; height: 4px; background: white; border-radius: 50%; box-shadow: 0 0 10px white; animation: sparkleMove 8s linear infinite; }
        .glass-morphism { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .header { padding: 2rem; margin: 1rem; position: relative; overflow: hidden; }
        .header::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.1), transparent); animation: rotate 10s linear infinite; }
        .logo-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .logo { width: 80px; height: 80px; background: linear-gradient(45deg, #ff6b9d, #ffa726); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; box-shadow: 0 0 30px rgba(255, 107, 157, 0.5); animation: logoPulse 3s ease-in-out infinite; position: relative; z-index: 2; overflow: hidden; }
        .logo img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        .header-logo-image { width: 120px; height: 120px; border-radius: 15px; object-fit: cover; border: 3px solid rgba(255, 255, 255, 0.4); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; }
        .header-logo-image:hover { transform: scale(1.05) rotateY(5deg); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3); }
        .main-title { text-align: center; font-size: 3.5rem; font-weight: 900; background: linear-gradient(45deg, #ff6b9d, #ffa726, #ab47bc, #42a5f5); background-size: 400% 400%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: modernGradientFlow 8s ease infinite, textGlow 2s ease-in-out infinite alternate; text-shadow: 0 0 30px rgba(255, 107, 157, 0.5); margin: 1rem 0; position: relative; z-index: 2; }
        .subtitle { text-align: center; font-size: 1.2rem; color: rgba(255, 255, 255, 0.9); margin-bottom: 2rem; position: relative; z-index: 2; }
        .header-info { display: flex; justify-content: space-between; align-items: center; gap: 2rem; margin: 2rem 0; position: relative; z-index: 2; }
        .header-image { width: 200px; height: 200px; border-radius: 15px; object-fit: cover; border: 3px solid rgba(255, 255, 255, 0.3); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; }
        .header-image:hover { transform: scale(1.05) rotateY(5deg); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); }
        .info-card { padding: 1rem 2rem; text-align: center; color: white; font-size: 1.1rem; }
        .stars-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 2rem; position: relative; z-index: 2; }
        .star-card { padding: 1.5rem; text-align: center; color: white; position: relative; overflow: hidden; transition: all 0.3s ease; }
        .star-card:nth-child(1) { background: linear-gradient(135deg, #ff6b9d, #ff8a80); }
        .star-card:nth-child(2) { background: linear-gradient(135deg, #ffa726, #ffcc02); }
        .star-card:nth-child(3) { background: linear-gradient(135deg, #ab47bc, #e1bee7); }
        .star-card:nth-child(4) { background: linear-gradient(135deg, #42a5f5, #81d4fa); }
        .star-card:hover { transform: translateY(-10px) scale(1.05); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2); }
        .navigation { position: sticky; top: 0; z-index: 100; margin: 0 1rem; padding: 1rem; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }
        .nav-button { padding: 1rem 2rem; background: linear-gradient(45deg, #ff6b9d, #ffa726); color: white; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; display: flex; align-items: center; gap: 0.5rem; }
        .nav-button::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent); transition: left 0.5s ease; }
        .nav-button:hover::before { left: 100%; }
        .nav-button:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
        .nav-button.active { background: linear-gradient(45deg, #ab47bc, #42a5f5); box-shadow: 0 0 20px rgba(171, 71, 188, 0.5); }
        .main-content { padding: 2rem; max-width: 1400px; margin: 0 auto; }
        .section { display: none; animation: fadeInUp 0.5s ease; }
        .section.active { display: block; }
        .attendance-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { padding: 1.5rem; text-align: center; color: white; position: relative; overflow: hidden; transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px) rotateX(10deg); }
        .stat-number { font-size: 2.5rem; font-weight: 900; margin-bottom: 0.5rem; }
        .stat-label { font-size: 1.1rem; opacity: 0.9; }
        .teachers-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .teacher-card { padding: 1.5rem; position: relative; overflow: hidden; transition: all 0.3s ease; cursor: pointer; }
        .teacher-card:hover { transform: translateY(-10px) rotateY(5deg) rotateX(5deg); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2); }
        .teacher-avatar { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, #ff6b9d, #ffa726); display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; margin: 0 auto 1rem; box-shadow: 0 0 20px rgba(255, 107, 157, 0.3); }
        .teacher-name { font-size: 1.3rem; font-weight: 700; text-align: center; margin-bottom: 0.5rem; color: white; }
        .teacher-class { text-align: center; color: rgba(255, 255, 255, 0.8); margin-bottom: 1rem; }
        .attendance-status { display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 1rem; }
        .status-btn { padding: 0.5rem 1rem; border: none; border-radius: 10px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; }
        .status-btn.present { background: #4caf50; color: white; }
        .status-btn.absent { background: #f44336; color: white; }
        .status-btn.late { background: #ff9800; color: white; }
        .status-btn.excused { background: #2196f3; color: white; }
        .status-btn:hover { transform: scale(1.1); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
        .teacher-actions { display: flex; justify-content: center; gap: 0.5rem; }
        .action-btn { padding: 0.5rem; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.2); color: white; cursor: pointer; transition: all 0.3s ease; }
        .action-btn:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); }
        .classes-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; }
        .class-card { padding: 2rem; position: relative; overflow: hidden; transition: all 0.3s ease; }
        .class-card:hover { transform: translateY(-10px) rotateY(5deg) rotateX(5deg); }
        .class-name { font-size: 1.5rem; font-weight: 700; text-align: center; margin-bottom: 1rem; color: white; }
        .class-points { text-align: center; font-size: 2rem; font-weight: 900; color: #ffa726; margin-bottom: 1.5rem; }
        .criteria-controls { display: flex; flex-direction: column; gap: 1rem; }
        .criteria-row { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .criteria-name { color: white; font-weight: 600; }
        .criteria-controls-btn { display: flex; align-items: center; gap: 1rem; }
        .point-btn { width: 40px; height: 40px; border: none; border-radius: 50%; font-size: 1.2rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; }
        .point-btn.plus { background: #4caf50; color: white; }
        .point-btn.minus { background: #f44336; color: white; }
        .point-btn:hover { transform: scale(1.2); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        .criteria-points { color: white; font-weight: 700; font-size: 1.1rem; min-width: 30px; text-align: center; }
        .system-management { max-width: 800px; margin: 0 auto; }
        .password-prompt { text-align: center; padding: 3rem; }
        .password-input { padding: 1rem; font-size: 1.2rem; border: none; border-radius: 10px; background: rgba(255, 255, 255, 0.2); color: white; text-align: center; margin: 1rem; width: 300px; }
        .password-input::placeholder { color: rgba(255, 255, 255, 0.7); }
        .tabs { display: flex; justify-content: center; margin-bottom: 2rem; gap: 0.5rem; flex-wrap: wrap; }
        .tab-btn { padding: 1rem 2rem; background: rgba(255, 255, 255, 0.1); color: white; border: none; border-radius: 10px 10px 0 0; cursor: pointer; transition: all 0.3s ease; }
        .tab-btn.active { background: rgba(255, 255, 255, 0.2); box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1); }
        .tab-content { display: none; padding: 2rem; background: rgba(255, 255, 255, 0.1); border-radius: 15px; backdrop-filter: blur(20px); }
        .tab-content.active { display: block; }
        @keyframes modernGradientFlow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes modernBackgroundPulse { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.1); } }
        @keyframes floatOrb { 0% { transform: translateY(100vh) translateX(0) rotate(0deg); } 100% { transform: translateY(-100px) translateX(100px) rotate(360deg); } }
        @keyframes sparkleMove { 0% { transform: translateY(100vh); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }
        @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes logoPulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255, 107, 157, 0.5); } 50% { transform: scale(1.1); box-shadow: 0 0 50px rgba(255, 107, 157, 0.8); } }
        @keyframes textGlow { 0% { text-shadow: 0 0 30px rgba(255, 107, 157, 0.5); } 100% { text-shadow: 0 0 50px rgba(255, 107, 157, 0.8), 0 0 70px rgba(255, 165, 38, 0.6); } }
        @keyframes fadeInUp { 0% { opacity: 0; transform: translateY(30px); } 100% { opacity: 1; transform: translateY(0); } }
        @media (max-width: 768px) { .main-title { font-size: 2.5rem; } .header-info { flex-direction: column; gap: 1rem; } .header-image { width: 150px; height: 150px; } .navigation { flex-direction: column; } .teachers-grid, .classes-grid { grid-template-columns: 1fr; } .attendance-stats { grid-template-columns: repeat(2, 1fr); } .tabs { flex-direction: column; } }
        .loading { display: flex; justify-content: center; align-items: center; padding: 2rem; color: white; font-size: 1.2rem; }
        .loading::after { content: ''; width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); z-index: 10000; display: none; justify-content: center; align-items: center; animation: fadeIn 0.3s ease; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.9)); border-radius: 20px; padding: 2rem; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); border: 2px solid rgba(255, 107, 157, 0.3); position: relative; animation: slideInUp 0.3s ease; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255, 107, 157, 0.2); }
        .modal-title { font-size: 1.5rem; font-weight: 700; color: #ff6b9d; margin: 0; }
        .modal-close { background: none; border: none; font-size: 1.5rem; color: #666; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: all 0.3s ease; }
        .modal-close:hover { background: rgba(244, 67, 54, 0.1); color: #f44336; transform: scale(1.1); }
        .modal-body { color: #333; }
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333; }
        .form-input { width: 100%; padding: 1rem; border: 2px solid rgba(255, 107, 157, 0.3); border-radius: 10px; font-size: 1rem; font-family: 'Tajawal', sans-serif; background: rgba(255, 255, 255, 0.8); transition: all 0.3s ease; }
        .form-input:focus { outline: none; border-color: #ff6b9d; box-shadow: 0 0 20px rgba(255, 107, 157, 0.3); background: white; }
        .form-textarea { min-height: 120px; resize: vertical; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; }
        .modal-btn { padding: 0.8rem 2rem; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-family: 'Tajawal', sans-serif; }
        .modal-btn-primary { background: linear-gradient(45deg, #ff6b9d, #ffa726); color: white; }
        .modal-btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(255, 107, 157, 0.4); }
        .modal-btn-secondary { background: rgba(108, 117, 125, 0.1); color: #6c757d; border: 2px solid rgba(108, 117, 125, 0.3); }
        .modal-btn-secondary:hover { background: rgba(108, 117, 125, 0.2); transform: translateY(-2px); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(50px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .notes-indicator { position: absolute; top: 10px; left: 10px; background: linear-gradient(45deg, #ffa726, #ffcc02); color: white; font-size: 0.8rem; padding: 0.3rem 0.6rem; border-radius: 15px; font-weight: 600; box-shadow: 0 2px 10px rgba(255, 165, 38, 0.4); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .report-preview-container { font-family: 'Tajawal', sans-serif; direction: rtl; padding: 2rem; border-radius: 15px; background: white; color: #333; text-align: right; }
        .report-header { text-align: center; margin-bottom: 2rem; border-bottom: 2px solid #ddd; padding-bottom: 1rem; }
        .report-title { font-size: 2rem; margin-bottom: 0.5rem; }
        .report-date { font-size: 1.1rem; color: #666; }
        .report-section-title { font-size: 1.5rem; margin-top: 2rem; margin-bottom: 1rem; border-right: 4px solid #ab47bc; padding-right: 1rem; }
        .report-list { list-style: none; padding: 0; margin: 0; }
        .report-list-item { padding: 0.75rem 1rem; border-bottom: 1px dashed #ddd; display: flex; justify-content: space-between; align-items: center; }
        .report-list-item:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <div class="live-background"></div>
    <div class="background-overlay"></div>

    <div class="floating-particles" id="particles"></div>

    <header class="header glass-morphism">
        <div class="logo-container">
            <div class="logo">
                â­
            </div>
            <img src="https://lh3.googleusercontent.com/d/1mtn3vRqkD9EotyQGuBAVxjTKxUyzSr3Y" 
                 alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" 
                 class="header-logo-image"
                 onerror="this.style.display='none'; console.log('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©');"
                 onload="console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­');">
            <img src="https://lh3.googleusercontent.com/d/1ER6aW7lGipFE4oZ3LW0vftXyoT9Lmf1n" 
                 alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" 
                 class="header-logo-image"
                 onerror="this.style.display='none'; console.log('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©');"
                 onload="console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­');">
        </div>
        
        <h1 class="main-title">Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</h1>
        <p class="subtitle">Ø§Ù†Ø¶Ø¨Ø§Ø· ÙŠØ¹ÙƒØ³ ÙˆØ¹ÙŠÙ‹Ø§ ÙˆÙ†Ø¸Ø§Ù… ÙŠØµÙ†Ø¹ Ø§Ù„Ø£Ø¬ÙŠØ§Ù„</p>
        
        <div class="header-info">
            <div class="info-card glass-morphism">
                <div>Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: Ø£.Ø£Ø­Ù„Ø§Ù… Ø¨Ù†Øª Ø¹Ù„ÙŠ Ø§Ù„Ø­Ù…Ø¯Ø§Ù†ÙŠØ©</div>
                <div id="currentDateTime"></div>
            </div>
        </div>

        <div class="stars-summary">
            <div class="star-card glass-morphism">
                <h3>ğŸŒŸ Ù†Ø¬Ù…Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
                <p id="starOfDay">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯</p>
            </div>
            <div class="star-card glass-morphism">
                <h3>â­ Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ±</h3>
                <p id="queueStar">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯</p>
            </div>
            <div class="star-card glass-morphism">
                <h3>ğŸ† Ù†Ø¬Ù…Ø© Ø§Ù„Ø´Ù‡Ø±</h3>
                <p id="starOfMonth">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯</p>
            </div>
            <div class="star-card glass-morphism">
                <h3>ğŸ‘‘ Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ù„Ù„Ø´Ù‡Ø±</h3>
                <p id="queueStarMonth">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯</p>
            </div>
        </div>
    </header>

    <nav class="navigation glass-morphism">
        <button class="nav-button active" onclick="showSection('attendance')">
            ğŸ‘¥ Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª
        </button>
        <button class="nav-button" onclick="showSection('queue-star')">
            â­ Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ±
        </button>
        <button class="nav-button" onclick="showSection('system-management')">
            âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        </button>
    </nav>

    <main class="main-content">
        <section id="attendance" class="section active">
            <div class="attendance-stats">
                <div class="stat-card glass-morphism" style="background: linear-gradient(135deg, #4caf50, #81c784);">
                    <div class="stat-number" id="presentCount">0</div>
                    <div class="stat-label">Ø­Ø§Ø¶Ø±Ø§Øª</div>
                </div>
                <div class="stat-card glass-morphism" style="background: linear-gradient(135deg, #f44336, #ef5350);">
                    <div class="stat-number" id="absentCount">0</div>
                    <div class="stat-label">ØºØ§Ø¦Ø¨Ø§Øª</div>
                </div>
                <div class="stat-card glass-morphism" style="background: linear-gradient(135deg, #ff9800, #ffb74d);">
                    <div class="stat-number" id="notRecordedCount">0</div>
                    <div class="stat-label">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</div>
                </div>
                <div class="stat-card glass-morphism" style="background: linear-gradient(135deg, #2196f3, #64b5f6);">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                </div>
            </div>

            <div class="glass-morphism" style="padding: 2rem; margin: 2rem 0;">
                <h3 style="color: white; text-align: center; margin-bottom: 1rem;">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                <div id="attendanceLog" style="color: white; text-align: center;">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±...
                </div>
            </div>

            <div class="teachers-grid" id="teachersGrid">
                <div class="glass-morphism loading" style="padding: 3rem; text-align: center; color: white; grid-column: 1 / -1;">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...
                </div>
            </div>
        </section>

        <section id="queue-star" class="section">
            <div class="classes-grid" id="classesGrid">
                <div class="glass-morphism loading" style="padding: 3rem; text-align: center; color: white; grid-column: 1 / -1;">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙÙˆÙ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...
                </div>
            </div>
        </section>

        <section id="system-management" class="section">
            <div class="system-management glass-morphism">
                <div id="passwordPrompt" class="password-prompt">
                    <h2 style="color: white; margin-bottom: 2rem;">ğŸ”’ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
                    <input type="password" class="password-input glass-morphism" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" id="systemPassword">
                    <br>
                    <button class="nav-button" onclick="checkSystemPassword()">Ø¯Ø®ÙˆÙ„</button>
                </div>

                <div id="systemContent" style="display: none;">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="showTab('teachers-management', this)">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª</button>
                        <button class="tab-btn" onclick="showTab('stars-management', this)">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¬ÙˆÙ…</button>
                        <button class="tab-btn" onclick="showTab('certificates', this)">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</button>
                        <button class="tab-btn" onclick="showTab('reports', this)">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
                        <button class="tab-btn" onclick="showTab('settings', this)">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                    </div>

                    <div id="teachers-management" class="tab-content active">
                        <h3 style="color: white; text-align: center; margin-bottom: 2rem;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                        
                        <div class="glass-morphism" style="padding: 2rem; margin-bottom: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                            <div id="dataManagementInfo" style="color: white; margin-bottom: 1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 10px;">
                                </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <button class="nav-button" onclick="loadDataFromSheet()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø´ÙŠØª</button>
                                <button class="nav-button" onclick="exportSavedData()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                                <button class="nav-button" onclick="importSavedData()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                                <button class="nav-button" onclick="clearAllSavedData()" style="background: #f44336;">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©</button>
                            </div>
                        </div>
                        
                        <div class="glass-morphism" style="padding: 2rem; margin-bottom: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">ğŸ“‹ Ø±Ø§Ø¨Ø· Ø§Ù„Ø´ÙŠØª Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                            <div style="color: white; margin-bottom: 1rem; padding: 1rem; background: rgba(33, 150, 243, 0.2); border-radius: 10px;">
                                <p style="margin-bottom: 0.5rem;">**Ù…Ù„Ø§Ø­Ø¸Ø©:** Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù† ÙŠØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„Ø´ÙŠØª. **Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŒ ÙŠÙØ¶Ù„ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ ÙˆØ±Ù‚Ø© "Teachers" ÙÙŠ Google Sheet Ù„Ø¥Ø¹Ø·Ø§Ø¦Ù‡Ø§ ID ØµØ­ÙŠØ­**.</p>
                            </div>
                            <div style="color: white; font-size: 0.9rem; word-break: break-all; background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
                                <strong>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø´ÙŠØª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ (API):</strong><br>
                                <span id="apiLinkDisplay"></span>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                            <button class="nav-button" onclick="showAddTeacherForm()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)</button>
                            <button class="nav-button" onclick="resetAllAttendance()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¶ÙˆØ±</button>
                        </div>

                        <div class="glass-morphism" style="padding: 2rem; margin-bottom: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø·</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <button class="nav-button" onclick="resetAllDailyPoints()">ğŸ“… Ù…Ø³Ø­ Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</button>
                                <button class="nav-button" onclick="addAllDailyToMonthly()">ğŸ“Š Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ… Ù„Ù„Ø´Ù‡Ø±</button>
                                <button class="nav-button" onclick="resetAllMonthlyPoints()">ğŸ—“ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</button>
                                <button class="nav-button" onclick="resetAllPoints()">ğŸ”„ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
                            </div>
                        </div>

                        <div id="addTeacherForm" class="tab-content">
                            <h4 style="color: white; margin-bottom: 1rem;">Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h4>
                            <div style="display: flex; justify-content: center; gap: 1rem; align-items: center; flex-wrap: wrap;">
                                <input type="text" id="newTeacherName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©" class="password-input glass-morphism" style="width: 200px;">
                                <input type="text" id="newTeacherClass" placeholder="Ø§Ù„ØµÙ" class="password-input glass-morphism" style="width: 150px;">
                                <button class="nav-button" onclick="addNewTeacher()">Ø¥Ø¶Ø§ÙØ©</button>
                                <button class="nav-button" onclick="hideAddTeacherForm()" style="background: #f44336;">Ø¥Ù„ØºØ§Ø¡</button>
                            </div>
                        </div>

                        <div class="glass-morphism" style="padding: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª</h4>
                            <div id="teachersManagementList" style="max-height: 400px; overflow-y: auto;">
                                </div>
                        </div>
                    </div>

                    <div id="stars-management" class="tab-content">
                        <h3 style="color: white; text-align: center; margin-bottom: 2rem;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¬ÙˆÙ…</h3>
                        
                        <div class="glass-morphism" style="padding: 2rem; margin-bottom: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">Ø§Ø®ØªÙŠØ§Ø± Ù†Ø¬ÙˆÙ… Ø§Ù„ÙŠÙˆÙ…</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                                <div>
                                    <label style="color: white; display: block; margin-bottom: 0.5rem;">ğŸŒŸ Ù†Ø¬Ù…Ø© Ø§Ù„ÙŠÙˆÙ…:</label>
                                    <select id="starOfDaySelect" class="password-input glass-morphism" style="width: 100%;">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="color: white; display: block; margin-bottom: 0.5rem;">â­ Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ±:</label>
                                    <select id="queueStarSelect" class="password-input glass-morphism" style="width: 100%;">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                    </select>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 1rem;">
                                <button class="nav-button" onclick="updateDailyStars()">ØªØ­Ø¯ÙŠØ« Ù†Ø¬ÙˆÙ… Ø§Ù„ÙŠÙˆÙ…</button>
                            </div>
                        </div>

                        <div class="glass-morphism" style="padding: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">Ù†Ø¬ÙˆÙ… Ø§Ù„Ø´Ù‡Ø±</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                                <div>
                                    <label style="color: white; display: block; margin-bottom: 0.5rem;">ğŸ† Ù†Ø¬Ù…Ø© Ø§Ù„Ø´Ù‡Ø±:</label>
                                    <select id="starOfMonthSelect" class="password-input glass-morphism" style="width: 100%;">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="color: white; display: block; margin-bottom: 0.5rem;">ğŸ‘‘ Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ù„Ù„Ø´Ù‡Ø±:</label>
                                    <select id="queueStarMonthSelect" class="password-input glass-morphism" style="width: 100%;">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                    </select>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 1rem;">
                                <button class="nav-button" onclick="updateMonthlyStars()">ØªØ­Ø¯ÙŠØ« Ù†Ø¬ÙˆÙ… Ø§Ù„Ø´Ù‡Ø±</button>
                            </div>
                        </div>
                    </div>

                    <div id="certificates" class="tab-content">
                        <h3 style="color: white; text-align: center; margin-bottom: 2rem;">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</h3>
                        
                        <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                            <button class="nav-button" onclick="printDailyCertificate()">ğŸŒŸ Ø´Ù‡Ø§Ø¯Ø© Ù†Ø¬Ù…Ø© Ø§Ù„ÙŠÙˆÙ…</button>
                            <button class="nav-button" onclick="printQueueCertificate()">â­ Ø´Ù‡Ø§Ø¯Ø© Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ±</button>
                            <button class="nav-button" onclick="printMonthlyCertificate()">ğŸ† Ø´Ù‡Ø§Ø¯Ø© Ù†Ø¬Ù…Ø© Ø§Ù„Ø´Ù‡Ø±</button>
                            <button class="nav-button" onclick="printAttendanceCertificate()">ğŸ“‹ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</button>
                        </div>

                        <div class="glass-morphism" style="padding: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</h4>
                            <div id="certificatePreview" style="background: white; padding: 2rem; border-radius: 15px; text-align: center; color: #333; min-height: 400px;">
                                <p>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡Ø§</p>
                            </div>
                            <div style="text-align: center; margin-top: 1rem;">
                                <button class="nav-button" onclick="printCertificate()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
                            </div>
                        </div>
                    </div>

                    <div id="reports" class="tab-content">
                        <h3 style="color: white; text-align: center; margin-bottom: 2rem;">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                        
                        <div class="glass-morphism" style="padding: 2rem; margin-bottom: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <button class="nav-button" onclick="generateAndExportDailyAttendance('image')">ğŸ“¸ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ (ØµÙˆØ±Ø©)</button>
                                <button class="nav-button" onclick="generateAndExportDailyAttendance('excel')">ğŸ“Š ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ (Excel)</button>
                                <button class="nav-button" onclick="generateAndExportDailyAttendance('pdf')">ğŸ“„ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ (PDF)</button>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <button class="nav-button" onclick="generateAndExportWeeklyAttendance('image')">ğŸ“¸ ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ (ØµÙˆØ±Ø©)</button>
                                <button class="nav-button" onclick="generateAndExportWeeklyAttendance('excel')">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ (Excel)</button>
                                <button class="nav-button" onclick="generateAndExportWeeklyAttendance('pdf')">ğŸ“„ ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ (PDF)</button>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <button class="nav-button" onclick="generateAndExportMonthlyAttendance('image')">ğŸ“¸ ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ (ØµÙˆØ±Ø©)</button>
                                <button class="nav-button" onclick="generateAndExportMonthlyAttendance('excel')">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ (Excel)</button>
                                <button class="nav-button" onclick="generateAndExportMonthlyAttendance('pdf')">ğŸ“„ ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ (PDF)</button>
                            </div>
                        </div>

                        <div class="glass-morphism" style="padding: 2rem; margin-bottom: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">â­ ØªÙ‚Ø§Ø±ÙŠØ± Ù†Ø¬ÙˆÙ… Ø§Ù„Ø·Ø§Ø¨ÙˆØ±</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <button class="nav-button" onclick="generateAndExportDailyStars('image')">ğŸ“¸ Ù†Ø¬ÙˆÙ… ÙŠÙˆÙ…ÙŠØ© (ØµÙˆØ±Ø©)</button>
                                <button class="nav-button" onclick="generateAndExportDailyStars('excel')">ğŸ“Š Ù†Ø¬ÙˆÙ… ÙŠÙˆÙ…ÙŠØ© (Excel)</button>
                                <button class="nav-button" onclick="generateAndExportDailyStars('pdf')">ğŸ“„ Ù†Ø¬ÙˆÙ… ÙŠÙˆÙ…ÙŠØ© (PDF)</button>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <button class="nav-button" onclick="generateAndExportWeeklyStars('image')">ğŸ“¸ Ù†Ø¬ÙˆÙ… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (ØµÙˆØ±Ø©)</button>
                                <button class="nav-button" onclick="generateAndExportWeeklyStars('excel')">ğŸ“Š Ù†Ø¬ÙˆÙ… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (Excel)</button>
                                <button class="nav-button" onclick="generateAndExportWeeklyStars('pdf')">ğŸ“„ Ù†Ø¬ÙˆÙ… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (PDF)</button>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <button class="nav-button" onclick="generateAndExportMonthlyStars('image')">ğŸ“¸ Ù†Ø¬ÙˆÙ… Ø´Ù‡Ø±ÙŠØ© (ØµÙˆØ±Ø©)</button>
                                <button class="nav-button" onclick="generateAndExportMonthlyStars('excel')">ğŸ“Š Ù†Ø¬ÙˆÙ… Ø´Ù‡Ø±ÙŠØ© (Excel)</button>
                                <button class="nav-button" onclick="generateAndExportMonthlyStars('pdf')">ğŸ“„ Ù†Ø¬ÙˆÙ… Ø´Ù‡Ø±ÙŠØ© (PDF)</button>
                            </div>
                        </div>

                        <div class="glass-morphism" style="padding: 2rem; margin-bottom: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">ğŸ“‹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <button class="nav-button" onclick="exportCompleteReport('excel')">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ (Excel)</button>
                                <button class="nav-button" onclick="exportCompleteReport('pdf')">ğŸ“„ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ (PDF)</button>
                            </div>
                        </div>

                        <div class="glass-morphism" style="padding: 2rem;">
                            <h4 style="color: white; margin-bottom: 1rem;">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h4>
                            <div id="reportPreview" style="background: white; padding: 2rem; border-radius: 15px; text-align: center; color: #333; min-height: 300px; max-height: 500px; overflow-y: auto;">
                                <p>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡</p>
                            </div>
                            <div style="text-align: center; margin-top: 1rem;">
                                <button class="nav-button" onclick="printReport()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                            </div>
                        </div>
                    </div>

                    <div id="settings" class="tab-content">
                        <h3 style="color: white; text-align: center;">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                        <div style="color: white;">
                            <div style="margin: 1rem 0;">
                                <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù†Ø¸Ø§Ù…:</label>
                                <input type="password" class="password-input glass-morphism" id="newSystemPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                                <button class="nav-button" onclick="updateSystemPassword()">ØªØ­Ø¯ÙŠØ«</button>
                            </div>
                            <div style="margin: 1rem 0;">
                                <label>Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ©:</label>
                                <input type="text" class="password-input glass-morphism" id="motivationalText" placeholder="Ø§Ù†Ø¶Ø¨Ø§Ø· ÙŠØ¹ÙƒØ³ ÙˆØ¹ÙŠÙ‹Ø§ ÙˆÙ†Ø¸Ø§Ù… ÙŠØµÙ†Ø¹ Ø§Ù„Ø£Ø¬ÙŠØ§Ù„" style="width: 400px;">
                                <button class="nav-button" onclick="updateMotivationalText()">ØªØ­Ø¯ÙŠØ«</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="teacherModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</h3>
                <button class="modal-close" onclick="closeTeacherModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©:</label>
                    <input type="text" id="editTeacherName" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ØµÙ:</label>
                    <input type="text" id="editTeacherClass" class="form-input" placeholder="Ø§Ù„ØµÙ">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                    <textarea id="editTeacherNotes" class="form-input form-textarea" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©..."></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="closeTeacherModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="modal-btn modal-btn-primary" onclick="saveTeacherChanges()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </div>
        </div>
    </div>

    <div id="classModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ</h3>
                <button class="modal-close" onclick="closeClassModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„ØµÙ:</label>
                    <input type="text" id="editClassName" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ">
                </div>
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                    <textarea id="editClassNotes" class="form-input form-textarea" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„ØµÙ..."></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="closeClassModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="modal-btn modal-btn-primary" onclick="saveClassChanges()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            </div>
        </div>
    </div>

    <div id="cameraModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“¸ ØªØµÙˆÙŠØ± Ø§Ù„Ø·Ø§Ø¨ÙˆØ±</h3>
                <button class="modal-close" onclick="closeCameraModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="cameraContainer" style="text-align: center;">
                    <div id="cameraPreview" style="position: relative; margin-bottom: 1rem;">
                        <video id="cameraVideo" style="width: 100%; max-width: 600px; height: auto; border-radius: 10px; background: #000;" autoplay muted></video>
                        <canvas id="cameraCanvas" style="display: none;"></canvas>
                        
                        <div id="photoOverlay" style="position: absolute; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 8px; font-family: 'Tajawal', sans-serif;">
                            <div id="overlayTeacherName" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 5px;"></div>
                            <div id="overlayClassName" style="font-size: 1rem; margin-bottom: 5px;"></div>
                            <div id="overlayDateTime" style="font-size: 0.9rem; opacity: 0.9;"></div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
                        <button id="startCameraBtn" class="modal-btn modal-btn-primary" onclick="startCamera()">
                            ğŸ“¹ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                        </button>
                        <button id="captureBtn" class="modal-btn modal-btn-primary" onclick="capturePhoto()" style="display: none;">
                            ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
                        </button>
                        <button id="switchCameraBtn" class="modal-btn modal-btn-secondary" onclick="switchCamera()" style="display: none;">
                            ğŸ”„ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                        </button>
                        <button id="stopCameraBtn" class="modal-btn modal-btn-secondary" onclick="stopCamera()" style="display: none;">
                            â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                        </button>
                    </div>
                    
                    <div id="capturedPhotos" style="display: none;">
                        <h4 style="color: #333; margin-bottom: 1rem;">Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</h4>
                        <div id="photosGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; max-height: 300px; overflow-y: auto;">
                            </div>
                    </div>
                    
                    <div id="cameraStatus" style="margin-top: 1rem; padding: 1rem; border-radius: 8px; display: none;">
                        </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="closeCameraModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="modal-btn modal-btn-primary" onclick="downloadAllPhotos()" id="downloadAllBtn" style="display: none;">
                    ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±
                </button>
            </div>
        </div>
    </div>

    <script>
        // =======================================================
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©
        // =======================================================
        let teachers = [];
        let classes = [];

        // âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        let systemPassword = 'admin123';
        let motivationalQuote = 'Ø§Ù†Ø¶Ø¨Ø§Ø· ÙŠØ¹ÙƒØ³ ÙˆØ¹ÙŠÙ‹Ø§ ÙˆÙ†Ø¸Ø§Ù… ÙŠØµÙ†Ø¹ Ø§Ù„Ø£Ø¬ÙŠØ§Ù„';

        // âš ï¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ API Ø§Ù„Ù…Ù†Ø´ÙˆØ± (ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø±Ø§Ø¨Ø·Ùƒ Ø§Ù„Ø£Ø®ÙŠØ±)
        const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbwM5XwTen_yz61BfmI17EWDxLElraUEDd8pRBYu461XnaVhs9kr1sK-2fqt1PGo-1_p/exec'; 

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
        let currentEditingTeacherId = null;
        let currentEditingClassIndex = null;
        let currentCameraTeacherId = null;
        let cameraStream = null;
        let currentCameraIndex = 0;
        let availableCameras = [];
        let capturedPhotosData = [];

        // =======================================================
        // 2. Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´ÙŠØª (READ/WRITE)
        // =======================================================

        async function loadDataFromSheet() {
            console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheet API...');
            
            try {
                const response = await fetch(SHEET_API_URL, { method: 'GET' });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();

                if (data.status === 'error') {
                    throw new Error(`API Error: ${data.message}`);
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙŠØª
                teachers = data.teachers.map(t => ({
                    id: Number(t.ID), 
                    name: t.Name, 
                    class: t.Class,
                    status: t.Status || 'not-recorded', 
                    timestamp: t.Timestamp || null,
                    notes: t.Notes || ''
                }));
                classes = data.classes.map(c => ({
                    name: c.ClassName, 
                    totalPoints: Number(c.TotalPoints) || 0,
                    dailyPoints: Number(c.DailyPoints) || 0, 
                    monthlyPoints: Number(c.MonthlyPoints) || 0,
                    quiet: Number(c.Quiet) || 0, 
                    speed: Number(c.Speed) || 0,
                    volume: Number(c.Volume) || 0, 
                    cleanliness: Number(c.Cleanliness) || 0,
                    notes: c.Notes || ''
                }));
                
                // â­ï¸ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®ØµØ§Øª Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ù„Ø¨
                updateStarSummaries();
                renderTeachers();
                renderClasses();
                updateStats();
                updateStarSelects();
                
                console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„: ${teachers.length} Ù…Ø¹Ù„Ù…Ø© Ùˆ ${classes.length} ØµÙ.`);
                return true;

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API:', error);
                document.getElementById('teachersGrid').innerHTML = '<div class="glass-morphism" style="padding: 3rem; text-align: center; color: white; grid-column: 1 / -1;"><h3>âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3><p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ø§Ø¨Ø· API ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø±.</p></div>';
                return false;
            }
        }

        async function syncToSheet(action, payload) {
            if (!SHEET_API_URL) return console.error('API URL not set.');

            try {
                const fullPayload = { action: action, ...payload };
                console.log(`ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ${action} Ø¥Ù„Ù‰ Ø§Ù„Ø´ÙŠØª:`, fullPayload);

                await fetch(SHEET_API_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(fullPayload)
                });
                
                console.log(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØºÙŠÙŠØ± Ø¨Ù†Ø¬Ø§Ø­: ${action}`);

            } catch (error) {
                console.error(`âŒ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØºÙŠÙŠØ± (${action}):`, error);
                alert(`âŒ ÙØ´Ù„ Ø§Ù„ØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« ${action}.`);
            }
        }

        function loadDataFromSheets() {
            // â­ï¸ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ loadDataFromSheet Ù…Ø¨Ø§Ø´Ø±Ø©
            loadDataFromSheet();
        }

        // =======================================================
        // 3. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„ØªÙŠ ØªØ³ØªØ¯Ø¹ÙŠ Ø§Ù„Ù€ Sync
        // =======================================================

        function getStatusText(status) { 
            const statusMap = { 'present': 'Ø­Ø§Ø¶Ø±Ø©', 'absent': 'ØºØ§Ø¦Ø¨Ø©', 'late': 'Ù…ØªØ£Ø®Ø±Ø©', 'excused': 'Ø¨Ø¹Ø°Ø±', 'not-recorded': 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„' };
            return statusMap[status] || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„'; 
        }

        // â­ï¸ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ØµØ­Ø­Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø· (Ù…Ø¹ ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ)
        function updatePointsWithSave(classIndex, criteria, change) {
            const classItem = classes[classIndex];
            if (!classItem) return;
            
            const currentValue = Number(classItem[criteria]) || 0; 
            
            const newValue = Math.max(0, currentValue + change); 
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            classItem[criteria] = newValue;
            classItem.totalPoints = classItem.quiet + classItem.speed + classItem.volume + classItem.cleanliness;
            classItem.dailyPoints = classItem.totalPoints;

            renderClasses(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
            updateStarSummaries(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¬ÙˆÙ… Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙˆØ±Ø§Ù‹

            // 1. Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´ÙŠØª
            syncToSheet('updatePoints', { className: classItem.name, criteria: criteria, newValue: newValue });
            // 2. â­ï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø© (Ù„Ù„ØªØ²Ø§Ù…Ù†)
            setTimeout(loadDataFromSheet, 1000); 

            const criteriaNames = { 'Quiet': 'Ø§Ù„Ù‡Ø¯ÙˆØ¡', 'Speed': 'Ø§Ù„Ø³Ø±Ø¹Ø©', 'Volume': 'Ø§Ù„ØµÙˆØª', 'Cleanliness': 'Ø§Ù„Ù†Ø¸Ø§ÙØ©' };
            alert(`ØªÙ… ØªØ­Ø¯ÙŠØ« ${criteriaNames[criteria]} Ù„Ù€ ${classItem.name}: ${newValue}`);
        }

        function updateAttendanceWithSave(teacherId, status) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (!teacher) return;
            
            const timestamp = new Date().toLocaleString('en-US', { hour12: true }); 
            teacher.status = status;
            teacher.timestamp = timestamp;
            
            renderTeachers();
            updateStats();
            
            syncToSheet('updateAttendance', { 
                id: teacherId, 
                status: status, 
                notes: teacher.notes,
                timestamp: timestamp 
            });
            
            setTimeout(loadDataFromSheet, 1000); // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            alert(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø¶ÙˆØ± ${teacher.name} Ø¥Ù„Ù‰: ${getStatusText(status)}`);
        }

        function resetTeacher(teacherId) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (teacher && confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø¶ÙˆØ± ${teacher.name}ØŸ`)) {
                teacher.status = 'not-recorded';
                teacher.timestamp = null; 
                
                syncToSheet('updateAttendance', { 
                    id: teacherId, 
                    status: '', 
                    notes: teacher.notes,
                    timestamp: null 
                });
                
                renderTeachers();
                updateStats();
                setTimeout(loadDataFromSheet, 1000);
                alert(`ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø¶ÙˆØ± ${teacher.name}`);
            }
        }
        
        // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©)

        // â­ï¸ Ø¯Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
        function updateStarSummaries() {
            // 1. â­ Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ± (Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…)
            const topDailyClass = classes.reduce((max, current) => 
                current.dailyPoints > max.dailyPoints ? current : max
            );
            document.getElementById('queueStar').textContent = (topDailyClass && topDailyClass.dailyPoints > 0) ? topDailyClass.name : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯';

            // 2. ğŸ‘‘ Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ù„Ù„Ø´Ù‡Ø± (Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø§Ù„Ø´Ù‡Ø±)
            const topMonthlyClass = classes.reduce((max, current) => 
                current.monthlyPoints > max.monthlyPoints ? current : max
            );
            document.getElementById('queueStarMonth').textContent = (topMonthlyClass && topMonthlyClass.monthlyPoints > 0) ? topMonthlyClass.name : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯';
            
            // 3. ğŸŒŸ Ù†Ø¬Ù…Ø© Ø§Ù„ÙŠÙˆÙ… (Ø£ÙˆÙ„ Ù…Ø¹Ù„Ù…Ø© ØªØ³Ø¬Ù„ Ø­Ø¶ÙˆØ±Ù‡Ø§)
            const firstPresentTeacher = teachers
                .filter(t => t.status === 'present' && t.timestamp)
                .sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp))[0];

            document.getElementById('starOfDay').textContent = firstPresentTeacher 
                ? `${firstPresentTeacher.name} (${firstPresentTeacher.class})` 
                : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯';
        }

        // =======================================================
        // 4. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±)
        // =======================================================
        
        function updateStats() {
            const present = teachers.filter(t => t.status === 'present').length;
            const absent = teachers.filter(t => t.status === 'absent').length;
            const notRecorded = teachers.filter(t => t.status === 'not-recorded').length;
            document.getElementById('presentCount').textContent = present;
            document.getElementById('absentCount').textContent = absent;
            document.getElementById('notRecordedCount').textContent = notRecorded;
            document.getElementById('totalCount').textContent = teachers.length;
            const recordedTeachers = teachers.filter(t => t.status !== 'not-recorded' && t.timestamp);
            const log = document.getElementById('attendanceLog');
            log.innerHTML = recordedTeachers.length === 0 ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…' : recordedTeachers.map(teacher => `<div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(255,255,255,0.1); border-radius: 8px;">${teacher.name} - ${getStatusText(teacher.status)} - ${teacher.timestamp}</div>`).join('');
        }
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('en-US', options);
        }
        function renderTeachers() { 
            const grid = document.getElementById('teachersGrid');
            if (teachers.length === 0) {
                grid.innerHTML = `<div class="glass-morphism" style="padding: 3rem; text-align: center; color: white; grid-column: 1 / -1;"><h3>ğŸ“‹ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ù„Ù…Ø§Øª</h3><p>ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets.</p></div>`;
                return;
            }
            grid.innerHTML = '';
            teachers.forEach((teacher) => {
                const card = document.createElement('div');
                card.className = 'teacher-card glass-morphism';
                let cardStyle = '';
                if (teacher.status === 'present') { cardStyle = 'background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(129, 199, 132, 0.2)); border: 2px solid rgba(76, 175, 80, 0.5);'; } else if (teacher.status === 'absent') { cardStyle = 'background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(239, 83, 80, 0.2)); border: 2px solid rgba(244, 67, 54, 0.5);'; } else if (teacher.status === 'late') { cardStyle = 'background: linear-gradient(135deg, rgba(255, 152, 0, 0.3), rgba(255, 183, 77, 0.2)); border: 2px solid rgba(255, 152, 0, 0.5);'; } else if (teacher.status === 'excused') { cardStyle = 'background: linear-gradient(135deg, rgba(33, 150, 243, 0.3), rgba(100, 181, 246, 0.2)); border: 2px solid rgba(33, 150, 243, 0.5);'; }
                card.style.cssText = cardStyle;
                const firstLetter = (teacher.name && teacher.name.charAt(0)) || '?';
                
                card.innerHTML = `
                    ${teacher.notes ? '<div class="notes-indicator">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>' : ''}
                    <div class="teacher-avatar">${firstLetter}</div>
                    <div class="teacher-name">${teacher.name || '---'}</div>
                    <div class="teacher-class">${teacher.class || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                    ${teacher.timestamp ? `<div style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin: 0.5rem 0; text-align: center;">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${teacher.timestamp}</div>` : ''}
                    ${teacher.notes ? `<div style="color: rgba(255,255,255,0.9); font-size: 0.85rem; margin: 0.5rem 0; text-align: center; background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 8px; max-height: 60px; overflow-y: auto;">ğŸ“ ${teacher.notes}</div>` : ''}
                    
                    <div class="attendance-status">
                        <button class="status-btn present" onclick="updateAttendanceWithSave(${teacher.id}, 'present')" style="${teacher.status === 'present' ? 'transform: scale(1.05); box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);' : ''}">âœ… Ø­Ø§Ø¶Ø±Ø©</button>
                        <button class="status-btn absent" onclick="updateAttendanceWithSave(${teacher.id}, 'absent')" style="${teacher.status === 'absent' ? 'transform: scale(1.05); box-shadow: 0 0 20px rgba(244, 67, 54, 0.6);' : ''}">âŒ ØºØ§Ø¦Ø¨Ø©</button>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 1rem;">
                        <button class="status-btn late" onclick="updateAttendanceWithSave(${teacher.id}, 'late')" style="${teacher.status === 'late' ? 'transform: scale(1.05); box-shadow: 0 0 20px rgba(255, 152, 0, 0.6);' : ''}">â° Ù…ØªØ£Ø®Ø±Ø©</button>
                        <button class="status-btn excused" onclick="updateAttendanceWithSave(${teacher.id}, 'excused')" style="${teacher.status === 'excused' ? 'transform: scale(1.05); box-shadow: 0 0 20px rgba(33, 150, 243, 0.6);' : ''}">ğŸ“‹ Ø¨Ø¹Ø°Ø±</button>
                    </div>
                    
                    <div class="teacher-actions">
                        <button class="action-btn" onclick="resetTeacher(${teacher.id})" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†">ğŸ”„</button>
                        <button class="action-btn" onclick="openTeacherModal(${teacher.id})" title="ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª">âœï¸</button>
                        <button class="action-btn" onclick="openCameraModal(${teacher.id})" title="ØªØµÙˆÙŠØ± Ø§Ù„Ø·Ø§Ø¨ÙˆØ±">ğŸ“¸</button>
                        <button class="action-btn" onclick="showTeacherDetails(${teacher.id})" title="Ø§Ù„ØªÙØ§ØµÙŠÙ„">â„¹ï¸</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        function renderClasses() { 
            const grid = document.getElementById('classesGrid');
            if (classes.length === 0) {
                grid.innerHTML = `<div class="glass-morphism" style="padding: 3rem; text-align: center; color: white; grid-column: 1 / -1;"><h3>ğŸ“š Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØµÙÙˆÙ</h3><p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ ÙˆØ±Ù‚Ø© "Classes".</p></div>`;
                return;
            }
            grid.innerHTML = '';
            const sortedClasses = [...classes].sort((a, b) => b.totalPoints - a.totalPoints);
            sortedClasses.forEach((classItem, index) => {
                const originalIndex = classes.findIndex(c => c.name === classItem.name);
                const card = document.createElement('div');
                card.className = 'class-card glass-morphism';
                let cardStyle = '';
                let rankIcon = '';
                if (index === 0 && classItem.totalPoints > 0) { cardStyle = 'background: linear-gradient(135deg, rgba(255, 193, 7, 0.4), rgba(255, 235, 59, 0.2)); border: 3px solid rgba(255, 193, 7, 0.7);'; rankIcon = 'ğŸ¥‡'; } else if (index === 1 && classItem.totalPoints > 0) { cardStyle = 'background: linear-gradient(135deg, rgba(158, 158, 158, 0.4), rgba(189, 189, 189, 0.2)); border: 3px solid rgba(158, 158, 158, 0.7);'; rankIcon = 'ğŸ¥ˆ'; } else if (index === 2 && classItem.totalPoints > 0) { cardStyle = 'background: linear-gradient(135deg, rgba(205, 127, 50, 0.4), rgba(255, 152, 0, 0.2)); border: 3px solid rgba(205, 127, 50, 0.7);'; rankIcon = 'ğŸ¥‰'; } else { rankIcon = 'ğŸ“Š'; }
                card.style.cssText = cardStyle;
                
                card.innerHTML = `
                    ${classItem.notes ? '<div class="notes-indicator">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>' : ''}
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">${rankIcon}</div>
                        <div class="class-name" style="margin: 0; font-size: 1.4rem;">${classItem.name || classItem.ClassName}</div>
                        ${classItem.totalPoints > 0 ? `<div style="font-size: 1rem; color: rgba(255,255,255,0.8); margin-top: 0.25rem;">Ø§Ù„Ù…Ø±ÙƒØ² ${index + 1}</div>` : ''}
                    </div>
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <div class="class-points" style="font-size: 3rem; margin-bottom: 0.5rem; text-shadow: 0 0 30px rgba(255, 165, 38, 0.8);">
                            ${classItem.totalPoints} Ù†Ù‚Ø·Ø©
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 1rem;">
                            <div style="background: rgba(255, 193, 7, 0.2); padding: 0.5rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #ffc107;">${classItem.dailyPoints || 0}</div>
                                <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</div>
                            </div>
                            <div style="background: rgba(156, 39, 176, 0.2); padding: 0.5rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #9c27b0;">${classItem.monthlyPoints || 0}</div>
                                <div style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Ù†Ù‚Ø§Ø· Ø§Ù„Ø´Ù‡Ø±</div>
                            </div>
                        </div>
                    </div>
                    ${classItem.notes ? `<div style="color: rgba(255,255,255,0.9); font-size: 0.85rem; margin: 1rem 0; text-align: center; background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 10px; max-height: 80px; overflow-y: auto;">ğŸ“ ${classItem.notes}</div>` : ''}
                    
                    <div class="criteria-controls">
                        <div class="criteria-row">
                            <span class="criteria-name">â­ Ø§Ù„Ù‡Ø¯ÙˆØ¡</span>
                            <div class="criteria-controls-btn">
                                <button class="point-btn minus" onclick="updatePointsWithSave(${originalIndex}, 'Quiet', -1)">-</button>
                                <span class="criteria-points">${classItem.quiet}</span>
                                <button class="point-btn plus" onclick="updatePointsWithSave(${originalIndex}, 'Quiet', 1)">+</button>
                            </div>
                        </div>
                        
                        <div class="criteria-row">
                            <span class="criteria-name">âš¡ Ø§Ù„Ø³Ø±Ø¹Ø©</span>
                            <div class="criteria-controls-btn">
                                <button class="point-btn minus" onclick="updatePointsWithSave(${originalIndex}, 'Speed', -1)">-</button>
                                <span class="criteria-points">${classItem.speed}</span>
                                <button class="point-btn plus" onclick="updatePointsWithSave(${originalIndex}, 'Speed', 1)">+</button>
                            </div>
                        </div>
                        
                        <div class="criteria-row">
                            <span class="criteria-name">ğŸ”Š Ø§Ù„ØµÙˆØª</span>
                            <div class="criteria-controls-btn">
                                <button class="point-btn minus" onclick="updatePointsWithSave(${originalIndex}, 'Volume', -1)">-</button>
                                <span class="criteria-points">${classItem.volume}</span>
                                <button class="point-btn plus" onclick="updatePointsWithSave(${originalIndex}, 'Volume', 1)">+</button>
                            </div>
                        </div>
                        
                        <div class="criteria-row">
                            <span class="criteria-name">ğŸ§¹ Ø§Ù„Ù†Ø¸Ø§ÙØ©</span>
                            <div class="criteria-controls-btn">
                                <button class="point-btn minus" onclick="updatePointsWithSave(${originalIndex}, 'Cleanliness', -1)">-</button>
                                <span class="criteria-points">${classItem.cleanliness}</span>
                                <button class="point-btn plus" onclick="updatePointsWithSave(${originalIndex}, 'Cleanliness', 1)">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <div style="display: flex; justify-content: center; gap: 0.25rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                            <button onclick="resetClassPoints(${originalIndex})" class="action-btn" style="background: rgba(255, 152, 0, 0.4); font-size: 0.8rem; padding: 0.4rem;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                            <button onclick="openClassModal(${originalIndex})" class="action-btn" style="background: rgba(33, 150, 243, 0.4); font-size: 0.8rem; padding: 0.4rem;">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                            <button onclick="setAsStarClass('${classItem.name}')" class="action-btn" style="background: rgba(255, 193, 7, 0.4); font-size: 0.8rem; padding: 0.4rem;">â­ Ù†Ø¬Ù… Ø§Ù„ÙŠÙˆÙ…</button>
                        </div>
                        <div style="display: flex; justify-content: center; gap: 0.25rem; flex-wrap: wrap;">
                            <button onclick="resetDailyPoints(${originalIndex})" class="action-btn" style="background: rgba(255, 193, 7, 0.3); font-size: 0.75rem; padding: 0.3rem;">ğŸ“… Ù…Ø³Ø­ Ø§Ù„ÙŠÙˆÙ…</button>
                            <button onclick="addToMonthlyPoints(${originalIndex})" class="action-btn" style="background: rgba(156, 39, 176, 0.3); font-size: 0.75rem; padding: 0.3rem;">ğŸ“Š Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ù‡Ø±</button>
                            <button onclick="resetMonthlyPoints(${originalIndex})" class="action-btn" style="background: rgba(156, 39, 176, 0.3); font-size: 0.75rem; padding: 0.3rem;">ğŸ—“ï¸ Ù…Ø³Ø­ Ø§Ù„Ø´Ù‡Ø±</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        function updateStarSelects() { 
             const teacherSelects = ['starOfDaySelect', 'starOfMonthSelect'];
             const classSelects = ['queueStarSelect', 'queueStarMonthSelect'];

             // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª
             teacherSelects.forEach(selectId => {
                 const select = document.getElementById(selectId);
                 if (select) {
                     select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</option>' +
                         teachers.map(t => `<option value="${t.name} (${t.class})">${t.name} (${t.class})</option>`).join('');
                 }
             });

             // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ØµÙÙˆÙ
             classSelects.forEach(selectId => {
                 const select = document.getElementById(selectId);
                 if (select) {
                     select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>' +
                         classes.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
                 }
             });
        }
        function updateDataManagement() { /* ... */ }
        function checkSystemPassword() {
            const input = document.getElementById('systemPassword');
            if (input.value === systemPassword) {
                document.getElementById('passwordPrompt').style.display = 'none';
                document.getElementById('systemContent').style.display = 'block';
                renderTeachersManagementList();
                updateStarSelects();
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                input.value = '';
            }
        }
        function showTab(tabName, btn) { document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.getElementById(tabName).classList.add('active'); btn.classList.add('active'); }
        function showSection(sectionName) { document.querySelectorAll('.section').forEach(section => section.classList.remove('active')); document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active')); document.getElementById(sectionName).classList.add('active'); document.querySelector(`[onclick="showSection('${sectionName}')"]`).classList.add('active'); }
        function closeTeacherModal() { document.getElementById('teacherModal').classList.remove('active'); currentEditingTeacherId = null; }
        function openTeacherModal(teacherId) { const teacher = teachers.find(t => t.id === teacherId); if (!teacher) return; currentEditingTeacherId = teacherId; document.getElementById('editTeacherName').value = teacher.name; document.getElementById('editTeacherClass').value = teacher.class; document.getElementById('editTeacherNotes').value = teacher.notes || ''; document.getElementById('teacherModal').classList.add('active'); }
        function openClassModal(classIndex) { const classItem = classes[classIndex]; if (!classItem) return; currentEditingClassIndex = classIndex; document.getElementById('editClassName').value = classItem.name; document.getElementById('editClassNotes').value = classItem.notes || ''; document.getElementById('classModal').classList.add('active'); }
        function closeClassModal() { document.getElementById('classModal').classList.remove('active'); currentEditingClassIndex = null; }
        function resetTeacher(teacherId) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (teacher && confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø¶ÙˆØ± ${teacher.name}ØŸ`)) {
                teacher.status = 'not-recorded';
                teacher.timestamp = null; 
                
                syncToSheet('updateAttendance', { 
                    id: teacherId, 
                    status: '', 
                    notes: teacher.notes,
                    timestamp: null 
                });
                
                renderTeachers();
                updateStats();
                setTimeout(loadDataFromSheet, 1000);
                alert(`ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø¶ÙˆØ± ${teacher.name}`);
            }
        }
        function showTeacherDetails(teacherId) { /* ... */ }
        function resetAllMonthlyPoints() { /* ... */ }
        function resetAllPoints() { /* ... */ }
        function setAsStarClass(className) { /* ... */ }
        
        // â­ï¸ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª (Ù…ÙÙØ¹Ù‘ÙÙ„Ø©)
        function printDailyCertificate() {
            const star = document.getElementById('starOfDay').textContent;
            if (star === 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯') { alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†Ø¬Ù…Ø© Ø§Ù„ÙŠÙˆÙ… Ø£ÙˆÙ„Ø§Ù‹'); return; }
            const target = teachers.find(t => `${t.name} (${t.class})` === star) || star;
            generateCertificate('Ù†Ø¬Ù…Ø© Ø§Ù„ÙŠÙˆÙ…', typeof target === 'string' ? target : `${target.name} (${target.class})`, 'ğŸŒŸ', target.name ? false : true);
        }

        function printQueueCertificate() {
            const star = document.getElementById('queueStar').textContent;
            if (star === 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯') { alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø£ÙˆÙ„Ø§Ù‹'); return; }
            generateCertificate('Ù†Ø¬Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ±', star, 'â­', true);
        }

        function printMonthlyCertificate() {
            const star = document.getElementById('starOfMonth').textContent;
            if (star === 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯') { alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†Ø¬Ù…Ø© Ø§Ù„Ø´Ù‡Ø± Ø£ÙˆÙ„Ø§Ù‹'); return; }
            const target = teachers.find(t => `${t.name} (${t.class})` === star) || star;
            generateCertificate('Ù†Ø¬Ù…Ø© Ø§Ù„Ø´Ù‡Ø±', typeof target === 'string' ? target : `${target.name} (${target.class})`, 'ğŸ†', target.name ? false : true);
        }

        function printAttendanceCertificate() {
            const presentTeachers = teachers.filter(t => t.status === 'present');
            if (presentTeachers.length === 0) { alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„Ù…Ø§Øª Ø­Ø§Ø¶Ø±Ø§Øª Ù„Ø·Ø¨Ø§Ø¹Ø© Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø­Ø¶ÙˆØ±'); return; }
            generateAttendanceCertificate(presentTeachers);
        }
        
        function generateCertificate(type, name, icon, isClass = true) {
            const dateInfo = getFormattedDates();
            const preview = document.getElementById('certificatePreview');
            const targetName = name.split(' (')[0];
            const targetClass = isClass ? name : name.split('(')[1]?.replace(')', '') || 'Ø§Ù„Ù…Ø¯Ø±Ø³Ø©';

            preview.innerHTML = `
                <div id="certificate-content-to-print" style="border: 5px solid #ffa726; padding: 3rem; border-radius: 20px; background: linear-gradient(45deg, #fff, #f8f9fa); position: relative; width: 100%; min-height: 500px;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">${icon}</div>
                        <h1 style="color: #ff6b9d; font-size: 2.5rem; margin-bottom: 0.5rem;">Ø´Ù‡Ø§Ø¯Ø© ØªÙ‚Ø¯ÙŠØ±</h1>
                        <h2 style="color: #ab47bc; font-size: 2rem;">${type}</h2>
                    </div>
                    <div style="margin: 3rem 0; padding: 2rem; background: rgba(255, 107, 157, 0.1); border-radius: 15px; text-align: center;">
                        <p style="font-size: 1.5rem; color: #333; margin-bottom: 1rem;">ØªÙÙ…Ù†Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù€ ${isClass ? 'ØµÙ' : 'Ø§Ù„Ù…Ø¹Ù„Ù…Ø©'}</p>
                        <h3 style="font-size: 2.5rem; color: #ff6b9d; margin: 1rem 0; font-weight: bold;">
                            ${targetName}
                        </h3>
                        <p style="font-size: 1.3rem; color: #666;">
                            ØªÙ‚Ø¯ÙŠØ±Ø§Ù‹ Ù„Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· ÙˆØ§Ù„ØªÙ…ÙŠØ² ÙÙŠ Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ
                        </p>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 3rem;">
                        <div style="text-align: center;">
                            <p style="color: #666; margin-bottom: 0.5rem;">Ø§Ù„ØªØ§Ø±ÙŠØ®</p>
                            <p style="color: #333; font-weight: bold;">${dateInfo.gregorian}</p>
                        </div>
                        <div style="text-align: center;">
                            <p style="color: #666; margin-bottom: 0.5rem;">Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</p>
                            <p style="color: #333; font-weight: bold;">Ø£.Ø£Ø­Ù„Ø§Ù… Ø¨Ù†Øª Ø¹Ù„ÙŠ Ø§Ù„Ø­Ù…Ø¯Ø§Ù†ÙŠØ©</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateAttendanceCertificate(presentTeachers) {
            const dateInfo = getFormattedDates();
            const preview = document.getElementById('certificatePreview');
            const presentList = presentTeachers.map((t, i) => `
                <div style="padding: 0.5rem; margin: 0.5rem 0; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                    ${i + 1}. ${t.name} - ${t.class} (${getStatusText(t.status)})
                </div>`).join('');

            preview.innerHTML = `
                <div id="certificate-content-to-print" class="report-preview-container" style="border: 5px solid #4caf50; padding: 2rem; border-radius: 20px; background: linear-gradient(45deg, #fff, #f8f9fa); position: relative; width: 100%; min-height: 500px;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“‹</div>
                        <h1 style="color: #4caf50; font-size: 2rem; margin-bottom: 0.5rem;">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø§Ù„Ù…Ù…ÙŠØ²</h1>
                        <p style="color: #333; font-weight: bold; margin-bottom: 0.25rem;">${dateInfo.gregorian}</p>
                    </div>
                    <div style="margin: 2rem 0; text-align: right;">
                        <h3 style="color: #333; margin-bottom: 1rem;">Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª (${presentTeachers.length}):</h3>
                        ${presentList}
                    </div>
                    <div style="text-align: center; margin-top: 2rem; border-top: 1px dashed #ddd; padding-top: 1rem;">
                        <p style="color: #666;">Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: Ø£.Ø£Ø­Ù„Ø§Ù… Ø¨Ù†Øª Ø¹Ù„ÙŠ Ø§Ù„Ø­Ù…Ø¯Ø§Ù†ÙŠØ©</p>
                    </div>
                </div>
            `;
        }

        function printCertificate() {
            const content = document.getElementById('certificatePreview').querySelector('#certificate-content-to-print');
            if (!content) { alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£ÙˆÙ„Ø§Ù‹.'); return; }

            // â­ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… HTML2Canvas ÙˆØ§Ù„Ù€ PDF Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© (Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©)
            window.jsPDF = window.jspdf.jsPDF;
            const doc = new jsPDF('l', 'pt', 'a4', true); // 'l' for landscape

            html2canvas(content, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const pdfWidth = doc.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                doc.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
                doc.save(`Ø´Ù‡Ø§Ø¯Ø©_${new Date().toISOString().split('T')[0]}.pdf`);
                alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF Ù„Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­.');
            });
        }
        
        // â­ï¸ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ§Ù„ØªØµØ¯ÙŠØ±)
        
        function generateAndExportDailyAttendance(format) {
            const dates = getFormattedDates();
            const present = teachers.filter(t => t.status === 'present').length;
            const absent = teachers.filter(t => t.status === 'absent').length;

            const preview = document.getElementById('reportPreview');
            preview.innerHTML = `
                <div id="report-content-to-print" class="report-preview-container" style="padding: 2rem; border: 1px solid #ddd;">
                    <div class="report-header">
                        <h1 class="report-title" style="color: #4caf50;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>
                        <p class="report-date">${dates.gregorian}</p>
                    </div>
                    <h3 class="report-section-title">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
                    <p>Ø§Ù„Ø­Ø§Ø¶Ø±Ø§Øª: ${present} / Ø§Ù„ØºØ§Ø¦Ø¨Ø§Øª: ${absent} / Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${teachers.length}</p>
                    <h3 class="report-section-title">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                    <ul class="report-list" style="list-style-type: none; padding: 0;">
                        ${teachers.map(t => `<li class="report-list-item"><span>${t.name}</span><span>${getStatusText(t.status)} (${t.timestamp || '---'})</span></li>`).join('')}
                    </ul>
                </div>
            `;
            if (format === 'excel') { exportAttendanceToExcel(); }
            if (format === 'pdf') { printReport(); }
            if (format === 'image') { captureAndDownloadImage('ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¶ÙˆØ±_Ø§Ù„ÙŠÙˆÙ…ÙŠ'); }
        }

        function generateAndExportDailyStars(format) {
            const dates = getFormattedDates();
            const sortedClasses = [...classes].sort((a, b) => b.dailyPoints - a.dailyPoints);
            const preview = document.getElementById('reportPreview');

            preview.innerHTML = `
                <div id="report-content-to-print" class="report-preview-container" style="padding: 2rem; border: 1px solid #ddd;">
                    <div class="report-header">
                        <h1 class="report-title" style="color: #ffc107;">ØªÙ‚Ø±ÙŠØ± Ù†Ø¬ÙˆÙ… Ø§Ù„ÙŠÙˆÙ…</h1>
                        <p class="report-date">${dates.gregorian}</p>
                    </div>
                    <h3 class="report-section-title">â­ ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙÙˆÙ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
                    <ul class="report-list" style="list-style-type: none; padding: 0;">
                        ${sortedClasses.map((c, index) => `<li class="report-list-item"><span>${index + 1}. ${c.name}</span><span>${c.dailyPoints} Ù†Ù‚Ø·Ø©</span></li>`).join('')}
                    </ul>
                </div>
            `;
            if (format === 'excel') { exportStarsToExcel('Daily'); }
            if (format === 'pdf') { printReport(); }
            if (format === 'image') { captureAndDownloadImage('ØªÙ‚Ø±ÙŠØ±_Ù†Ø¬ÙˆÙ…_Ø§Ù„ÙŠÙˆÙ…'); }
        }
        
        function exportCompleteReport(format) {
            const dates = getFormattedDates();
            const present = teachers.filter(t => t.status === 'present').length;
            const sortedClasses = [...classes].sort((a, b) => b.totalPoints - a.totalPoints);
            
            const preview = document.getElementById('reportPreview');
            preview.innerHTML = `
                <div id="report-content-to-print" class="report-preview-container" style="padding: 2rem; border: 1px solid #ddd;">
                    <div class="report-header">
                        <h1 class="report-title" style="color: #ab47bc;">ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„</h1>
                        <p class="report-date">${dates.gregorian}</p>
                    </div>
                    <h3 class="report-section-title">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                    <p>Ø§Ù„Ø­Ø§Ø¶Ø±Ø§Øª: ${present} / Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${teachers.length}</p>
                    <h3 class="report-section-title">ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙÙˆÙ (ØªØ±Ø§ÙƒÙ…ÙŠ)</h3>
                    <ul class="report-list" style="list-style-type: none; padding: 0;">
                        ${sortedClasses.map((c, index) => `<li class="report-list-item"><span>${index + 1}. ${c.name}</span><span>${c.totalPoints} Ù†Ù‚Ø·Ø© ØªØ±Ø§ÙƒÙ…ÙŠØ©</span></li>`).join('')}
                    </ul>
                </div>
            `;
            if (format === 'excel') { exportCompleteReportToExcel(); }
            if (format === 'pdf') { printReport(); }
            if (format === 'image') { captureAndDownloadImage('ØªÙ‚Ø±ÙŠØ±_Ø´Ø§Ù…Ù„'); }
        }
        
        function captureAndDownloadImage(filename) {
            const content = document.getElementById('reportPreview').querySelector('#report-content-to-print');
            if (!content) { alert('ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£ÙˆÙ„Ø§Ù‹.'); return; }

            html2canvas(content, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = `${filename}_${getFormattedDates().gregorian}.png`;
                link.click();
                alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.');
            });
        }
        
        function printReport() {
            const content = document.getElementById('reportPreview').querySelector('#report-content-to-print');
            if (!content) { alert('ÙŠØ±Ø¬Ù‰ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£ÙˆÙ„Ø§Ù‹.'); return; }

            window.jsPDF = window.jspdf.jsPDF;
            const doc = new jsPDF('p', 'pt', 'a4', true);

            html2canvas(content, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const pdfWidth = doc.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                doc.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
                doc.save(`ØªÙ‚Ø±ÙŠØ±_${getFormattedDates().gregorian}.pdf`);
                alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­.');
            });
        }
        
        function exportAttendanceToExcel() {
            const data = [['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ'], ['Ø§Ù„ØªØ§Ø±ÙŠØ®', getFormattedDates().gregorian], [], ['ID', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªØ³Ø¬ÙŠÙ„']];
            teachers.forEach(t => data.push([t.id, t.name, t.class, getStatusText(t.status), t.timestamp || '']));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(data), 'Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ');
            XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¶ÙˆØ±_${getFormattedDates().gregorian}.xlsx`);
        }

        function exportStarsToExcel(type) {
            const sorted = [...classes].sort((a, b) => b.totalPoints - a.totalPoints);
            const data = [['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ø¬ÙˆÙ…'], ['Ø§Ù„ØªØ§Ø±ÙŠØ®', getFormattedDates().gregorian], [], ['Ø§Ù„Ù…Ø±ÙƒØ²', 'Ø§Ø³Ù… Ø§Ù„ØµÙ', 'Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…', 'Ù†Ù‚Ø§Ø· Ø§Ù„Ø´Ù‡Ø±']];
            sorted.forEach((c, index) => data.push([index + 1, c.name, c.dailyPoints, c.monthlyPoints]));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(data), 'Ø§Ù„Ù†Ø¬ÙˆÙ…');
            XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù†Ø¬ÙˆÙ…_${type}_${getFormattedDates().gregorian}.xlsx`);
        }

        function exportCompleteReportToExcel() {
            const attendanceData = [['ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ'], ['Ø§Ù„ØªØ§Ø±ÙŠØ®', getFormattedDates().gregorian], [], ['ID', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…Ø©', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªØ³Ø¬ÙŠÙ„']];
            teachers.forEach(t => attendanceData.push([t.id, t.name, t.class, getStatusText(t.status), t.timestamp || '']));

            const starsData = [['ØªÙ‚Ø±ÙŠØ± Ù†Ù‚Ø§Ø· Ø§Ù„ØµÙÙˆÙ'], ['Ø§Ù„ØªØ§Ø±ÙŠØ®', getFormattedDates().gregorian], [], ['Ø§Ù„Ù…Ø±ÙƒØ²', 'Ø§Ø³Ù… Ø§Ù„ØµÙ', 'Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…', 'Ù†Ù‚Ø§Ø· Ø§Ù„Ø´Ù‡Ø±']];
            const sortedClasses = [...classes].sort((a, b) => b.totalPoints - a.totalPoints);
            sortedClasses.forEach((c, index) => starsData.push([index + 1, c.name, c.dailyPoints, c.monthlyPoints]));

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(attendanceData), 'Ø§Ù„Ø­Ø¶ÙˆØ±');
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(starsData), 'Ø§Ù„Ù†Ø¬ÙˆÙ…');
            XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±_Ø´Ø§Ù…Ù„_${getFormattedDates().gregorian}.xlsx`);
        }

        function getFormattedDates() { 
            const now = new Date();
            return { gregorian: now.toLocaleDateString('ar-SA'), hijri: now.toLocaleDateString('ar-SA-u-ca-islamic') };
        }
        
        function renderTeachersManagementList() { /* ... */ }
        function openCameraModal(teacherId) { /* ... */ }
        function closeCameraModal() { /* ... */ }
        function showTeacherDetails(teacherId) { /* ... */ }
        function resetAllMonthlyPoints() { /* ... */ }
        function resetAllPoints() { /* ... */ }
        function setAsStarClass(className) { /* ... */ }
        
        function updateStarSummaries() {
            const topDailyClass = classes.reduce((max, current) => 
                current.dailyPoints > max.dailyPoints ? current : max
            );
            document.getElementById('queueStar').textContent = (topDailyClass && topDailyClass.dailyPoints > 0) ? topDailyClass.name : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯';

            const topMonthlyClass = classes.reduce((max, current) => 
                current.monthlyPoints > max.monthlyPoints ? current : max
            );
            document.getElementById('queueStarMonth').textContent = (topMonthlyClass && topMonthlyClass.monthlyPoints > 0) ? topMonthlyClass.name : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯';
            
            const firstPresentTeacher = teachers
                .filter(t => t.status === 'present' && t.timestamp)
                .sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp))[0];

            document.getElementById('starOfDay').textContent = firstPresentTeacher 
                ? `${firstPresentTeacher.name} (${firstPresentTeacher.class})` 
                : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯';
        }

        // ... (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„)

        document.addEventListener('DOMContentLoaded', async function() {
            const apiLinkDisplay = document.getElementById('apiLinkDisplay');
            if (apiLinkDisplay) {
                apiLinkDisplay.textContent = SHEET_API_URL;
            }
            
            const dataLoaded = await loadDataFromSheet();
            
            if (dataLoaded) {
                updateDateTime();
                setInterval(updateDateTime, 60000);
                
                if (document.getElementById('dataManagementInfo')) {
                    updateDataManagement();
                }
            }
            
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
        });
    </script>
</body>
</html>
